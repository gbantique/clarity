---
title: 002 - Brickcell DHT11 | MakeCode Microbit
url: /2023/09/30/brickcell_dht11/
author: George Bantique
series:
  - MakeCode, Microbit, Brickcell
categories:
  - MakeCode
  - microbit
date: '2023-09-30T10:47:00+08:00'
tags:
  - MakeCode
  - microbit
---

## **Introduction**

The DHT11 is a low-cost, digital temperature and humidity sensor. It is commonly used in electronics projects and application to measure temperature and relative humidity. The sensor is consists of a capacitive humidity seensor and a thermistor to measure temperature. It provides digital output, making it relatively easy to interface with microcontrollers like microbit.

### **Temperature Range**

The DHT11 can measure temperatures in the range of 0 degree Celsius to 50 degrees Celsius with accuracy of +/-2 degrees Celsius.

### **Humidity Range**

The DHT11 can measure humidity in the range of 20% to 90% with a +/-5% accuracy.

### **Interface**

The DHT11 communicates with the microcontr4oller using a single-wire (1-wire) communication protocol, which involves sending and receiving data via a single data pin.


## **Source Code**

Lets see how we can apply this to a MakeCode typescript programming. Essentially to create an extension to simplify block programming in <https://makecode.microbit.org/>. The following extension code is a modified version of [https://github.com/alankrantas/pxt-DHT11_DHT22/](https://github.com/alankrantas/pxt-DHT11_DHT22/) which supports both DHT11 and DHT22 sensor. Since in Brickcell, we only have the DHT11, we will be trimming the code to minimize the size of the extension code.

### **brickcell-dht11**

You may directly used this extension by searching under the MakeCode extension and typing the following hyperlink:
[https://github.com/gbantique/brickcell-dht11/](https://github.com/gbantique/brickcell-dht11/)

```ts {title="brickcell-dht11.ts"}
/**
 * MakeCode editor extension for DHT11 and DHT22 humidity/temperature sensors
 * by Alan Wang
 */

enum dataType {
    //% block="temperature"
    temperature,
    //% block="humidity"
    humidity,
}

//% color="#FFBF00" icon="\uf12e" weight=70
namespace Brickcell {

    let _temperature: number = -999.0
    let _humidity: number = -999.0

    /**
    * Read DHT sensor on %dataPin
    */
    //% block="Read $data on pin $dataPin"
    //% blockId=brickcell_dht11_read_dht
    //% subcategory="dht11"
    export function readDHT(data: dataType, dataPin: DigitalPin): number {

        //initialize
        let checksum: number = 0
        let checksumTmp: number = 0
        let dataArray: boolean[] = []
        let resultArray: number[] = []

        for (let index = 0; index < 40; index++) dataArray.push(false)
        for (let index = 0; index < 5; index++) resultArray.push(0)

        _humidity = -999.0
        _temperature = -999.0

        //request data
        pins.digitalWritePin(dataPin, 0) //begin protocol, pull down pin
        basic.pause(18)

        pins.setPull(dataPin, PinPullMode.PullUp)
        pins.digitalReadPin(dataPin) //pull up pin
        control.waitMicros(40)

        if (pins.digitalReadPin(dataPin) == 0) {

            while (pins.digitalReadPin(dataPin) == 0); //sensor response
            while (pins.digitalReadPin(dataPin) == 1); //sensor response

            //read data (5 bytes)
            for (let index = 0; index < 40; index++) {
                while (pins.digitalReadPin(dataPin) == 1);
                while (pins.digitalReadPin(dataPin) == 0);
                control.waitMicros(28)
                //if sensor still pull up data pin after 28 us it means 1, otherwise 0
                if (pins.digitalReadPin(dataPin) == 1) dataArray[index] = true
            }

            //convert byte number array to integer
            for (let index = 0; index < 5; index++)
                for (let index2 = 0; index2 < 8; index2++)
                    if (dataArray[8 * index + index2]) resultArray[index] += 2 ** (7 - index2)

            //verify checksum
            checksumTmp = resultArray[0] + resultArray[1] + resultArray[2] + resultArray[3]
            checksum = resultArray[4]
            if (checksumTmp >= 512) checksumTmp -= 512
            if (checksumTmp >= 256) checksumTmp -= 256

            if (checksum == checksumTmp) {
                //DHT11
                _humidity = resultArray[0] + resultArray[1] / 100
                _temperature = resultArray[2] + resultArray[3] / 100
            }
        }

        //wait 2 sec after query if needed
        return dataType.humidity ? _humidity : _temperature
    }
}
```

### **Extension Code Explanation**

_enum dataType_
- this defines an enumeration to represent the data types, specifically "humidity" and "temperature".

_namespace Brickcell_
: creates a namespace to include the code under the Brickcell module / extension

_readDHT_
- is a function that reads data from the DHT sensor. It takes a `dataPin` parameter, which specifies the digital pin connected to the DHT sensor signal pin.
- The function works as follows:
    * It sends a request to the DHT sensor by pulling down the `dataPin` for 18 milliseconds and then releasing it.
    * It waits for the sensor to respond by check the `dataPin` state.
    * If the sensor responds, it proceeds to read 40 bits of data from the sensor, which includes humidity and temperature values.
    * The function then calculates a checksum to verify the integrity of the data.
    * If the checksum matches, it converts the received data bytes into actual humidity and temperature values.
    * Finally, it returns either the humidity or temperature value baseed on the `dataType` enum specified.

_The code essentially communicates with the DHT sensor according to its protocol, reads the data, and performs data validation to ensure the accuracy of the readings. If the readings are valid, it returns the requested data either temperature or humidity depending on the set `dataType` enum.

### **How to try using the Brickcell DHT11 extension**

1. Login to [https://makecode.microbit.org/](https://makecode.microbit.org/) using your Microsoft account.
2. Create a new project by clicking the "New Project" button. You may name it anything you want, I suggest to name it with descriptive name such as "dht11-test".
3. Click the "Extensions" block just under the "Math" block.
4. Type [https://github.com/gbantique/brickcell-dht11/](https://github.com/gbantique/brickcell-dht11/) on the search bar.
5. Select the "brickcell-dht11" from the search results. The "dht11" block should appear under the "Brickcell" block.

A copy of test file could be found by selecting "Javascript", and under the Explorer > brickcell-dht11 > test.ts. Select it and you may copy and paste the code to main.ts file. Selecting "Blocks" again will display the test code in block programming.

#### **test.ts**

```ts
serial.setBaudRate(BaudRate.BaudRate115200)

basic.forever(function () {
    serial.writeLine("" + (Brickcell.readDHT(dataType.temperature, DigitalPin.P0)))
    basic.pause(2000)
})

```

#### **Hardware Instruction**

1. Connect the DHT11 sensor GND pin to microbit GND pin.
2. Connect the DHT11 sensor VCC pin to microbit VCC pin.
3. Connect the DHT11 sensor signal (S) pin to microbit pin 0.

#### **Expected result of test.ts**

The test file should make the microbit microcontroller to send the measured temperature/humidity through serial with 115200 baud rate.

The measured distance should refresh every after 2 seconds.



